<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Biquadratic Filter Structure and Transfer Function Analyzer</title>

<!-- MathJax -->
<script>
window.MathJax = {
  tex: {displayMath: [['\\[','\\]']]}
};
</script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

<style>
  body {
    font-family: sans-serif;
    max-width: 820px;
    margin: auto;
    padding: 20px;
    line-height: 1.6;
  }

  #diagram-container {
    position: relative;
    display: inline-block;
  }

  #diagram-container img {
    width: 100%;
    max-width: 750px;
    border: 1px solid #ddd;
  }

  .coeff-label {
    position: absolute;
    background: rgba(255,255,255,0.2);
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 20px;
    font-style: italic;
    font-family: "Cambria Math", "STIX Two Math",
                 "Latin Modern Math", "Times New Roman", serif;
  }

  h2 {
    margin-top: 40px;
    font-weight: 500;
  }
</style>
</head>

<body>

<h1>Biquadratic Filter Structure and Transfer Function Analyzer</h1>

<div id="diagram-container">
  <img src="biquadraticstructure.jpg" id="biquad-img">
  <div class="coeff-label" id="label-k" style="top:11%; left:15%;">\(\times 1\)</div>
  <div class="coeff-label" id="label-b0" style="top:10%; left:60%;">\(\times b_0\)</div>  
  <div class="coeff-label" id="label-b1" style="top:50%; left:60%;">\(\times b_1\)</div>
  <div class="coeff-label" id="label-b2" style="top:87%; left:60%;">\(\times b_2\)</div>

  <div class="coeff-label" id="label-a1" style="top:50%; left:35%;">\(\times a_1\)</div>
  <div class="coeff-label" id="label-a2" style="top:87%; left:35%;">\(\times a_2\)</div>
</div>

<!-- ========================================================= -->
<!-- INPUT SECTION -->
<!-- ========================================================= -->

<div style="margin-top:20px;">

  <h3>Enter Coefficient Values</h3>

  <label>b₀: <input id="input-b0" type="number" step="0.001"></label><br>
  <label>b₁: <input id="input-b1" type="number" step="0.001"></label><br>
  <label>b₂: <input id="input-b2" type="number" step="0.001"></label><br>
  <label>a₁: <input id="input-a1" type="number" step="0.001"></label><br>
  <label>a₂: <input id="input-a2" type="number" step="0.001"></label><br>

  <button onclick="updateFromInputs()" 
          style="margin-top:10px; font-size:16px;">
    Calculate
  </button>

</div>

<!-- ========================================================= -->

<h2>Transfer Function</h2>
<div id="tf-display"></div>

<!-- High-level derivation -->
<details style="margin-top:40px;">
  <summary style="font-size:18px; font-weight:600; cursor:pointer;">
    Show Derivation of the Transfer Function
  </summary>

  <div style="margin-top:20px;">
    <h3>Time-Domain Equations</h3>

    <p>The biquadratic filter uses the internal state \( w[n] \):</p>

    \[
      w[n] = x[n] - a_1 w[n-1] - a_2 w[n-2]
    \]

    <p>The output is:</p>

    \[
      y[n] = b_0 w[n] + b_1 w[n-1] + b_2 w[n-2]
    \]

    <h3>Z-Domain</h3>

    \[
      W(z) = X(z) - a_1 z^{-1}W(z) - a_2 z^{-2}W(z)
    \]

    \[
      W(z)\left(1 + a_1 z^{-1} + a_2 z^{-2}\right) = X(z)
    \]

    \[
      H(z) =
      \frac{b_0 + b_1 z^{-1} + b_2 z^{-2}}
           {1 + a_1 z^{-1} + a_2 z^{-2}}
    \]

  </div>
</details>


<!-- Detailed derivation using actual coefficients -->
<details style="margin-top:40px;">
  <summary style="font-size:18px; font-weight:600; cursor:pointer;">
    Show Detailed Derivation (Using Actual Coefficient Values)
  </summary>

  <div id="derivation-body" style="margin-top:20px;"></div>
</details>



<!-- ========================================================= -->
<!-- JAVASCRIPT -->
<!-- ========================================================= -->

<script>
// ------------------ Formatting helpers ------------------
function formatCoeff(c) {
  return c < 0 ? `(${c})` : `${c}`;
}

function formatCoeffFlipped(c) {
  const f = -c;
  return f < 0 ? `(${f.toFixed(3)})` : `${f.toFixed(3)}`;
}

function term(c, p) {
  if (c === 0) return "";
  const sign = c > 0 ? " + " : " - ";
  const mag = Math.abs(c).toFixed(3);
  return p === 0 ? `${sign}${mag}` : `${sign}${mag} z^{-${p}}`;
}

function coeffRaw(c) {
  return c < 0 ? `(${c})` : `${c}`;
}


// =========================================================
// UPDATE FUNCTION (called when user presses Calculate)
// =========================================================
function updateFromInputs() {

  const coeffs = {
    b0: Number(document.getElementById("input-b0").value),
    b1: Number(document.getElementById("input-b1").value),
    b2: Number(document.getElementById("input-b2").value),
    a1: Number(document.getElementById("input-a1").value),
    a2: Number(document.getElementById("input-a2").value)
  };

  // ===== Update diagram labels =====
  document.getElementById("label-b0").innerHTML = `\\(\\times ${formatCoeff(coeffs.b0)}\\)`;
  document.getElementById("label-b1").innerHTML = `\\(\\times ${formatCoeff(coeffs.b1)}\\)`;
  document.getElementById("label-b2").innerHTML = `\\(\\times ${formatCoeff(coeffs.b2)}\\)`;

  document.getElementById("label-a1").innerHTML = `\\(\\times ${formatCoeffFlipped(coeffs.a1)}\\)`;
  document.getElementById("label-a2").innerHTML = `\\(\\times ${formatCoeffFlipped(coeffs.a2)}\\)`;

  // ===== Build transfer function =====
  const H_num =
    coeffs.b0.toFixed(3) +
    term(coeffs.b1, 1) +
    term(coeffs.b2, 2);

  const H_den =
    "1" +
    term(coeffs.a1, 1) +
    term(coeffs.a2, 2);

  document.getElementById("tf-display").innerHTML = `
  \\[
  H(z) = \\frac{ ${H_num} }{ ${H_den} }
  \\]
  `;

  // ===== Build derivation text (single-line format) =====

  const eq_w = `w[n] = x[n] ${coeffs.a1>=0?`- ${coeffRaw(coeffs.a1)}`:`+ ${coeffRaw(-coeffs.a1)}`} w[n-1] ${coeffs.a2>=0?`- ${coeffRaw(coeffs.a2)}`:`+ ${coeffRaw(-coeffs.a2)}`} w[n-2]`;
  const eq_y = `y[n] = ${coeffRaw(coeffs.b0)} w[n] ${coeffs.b1>=0?`+ ${coeffRaw(coeffs.b1)}`:`- ${coeffRaw(-coeffs.b1)}`} w[n-1] ${coeffs.b2>=0?`+ ${coeffRaw(coeffs.b2)}`:`- ${coeffRaw(-coeffs.b2)}`} w[n-2]`;

  document.getElementById("derivation-body").innerHTML = `

<h3>High-Level Derivation</h3>

<p>The biquad is defined by:</p>

\\[ ${eq_w} \\]
\\[ ${eq_y} \\]

<p>This leads directly to:</p>

\\[
H(z) = \\frac{ ${H_num} }{ ${H_den} }
\\]

<hr>

<h3>Medium-Level Derivation</h3>

<p><b>1. Apply Z-transforms:</b></p>

\\[
\\mathcal{Z}\\{w[n]\\}=W(z),\\quad
\\mathcal{Z}\\{w[n-1]\\}=z^{-1}W(z),\\quad
\\mathcal{Z}\\{w[n-2]\\}=z^{-2}W(z)
\\]

<p>Apply to the state equation:</p>

\\[
W(z)=X(z)
${coeffs.a1>=0?`- ${coeffRaw(coeffs.a1)}`:`+ ${coeffRaw(-coeffs.a1)}`} z^{-1}W(z)
${coeffs.a2>=0?`- ${coeffRaw(coeffs.a2)}`:`+ ${coeffRaw(-coeffs.a2)}`} z^{-2}W(z)
\\]

<details style="margin-top:15px;">
  <summary style="font-size:15px; cursor:pointer;">Show Full Factorisation</summary>

  <div style="margin-left:20px; margin-top:10px;">

    <p>Group like terms:</p>

\\[
W(z) + ${coeffRaw(coeffs.a1)} z^{-1}W(z)
     + ${coeffRaw(coeffs.a2)} z^{-2}W(z)
= X(z)
\\]

    <p>Factor:</p>

\\[
W(z)(1 ${term(coeffs.a1,1)} ${term(coeffs.a2,2)}) = X(z)
\\]

    <p>Solve for \(W(z)\):</p>

\\[
W(z) = \\frac{X(z)}{${H_den}}
\\]

  </div>
</details>

<hr>

<h3>2. Output Equation</h3>

\\[
Y(z) = (${H_num})\, W(z)
\\]

<details style="margin-top:15px;">
  <summary style="font-size:15px; cursor:pointer;">Show Substitution Steps</summary>

  <div style="margin-left:20px; margin-top:10px;">

\\[
Y(z)=(${H_num})\\frac{X(z)}{${H_den}}
\\]

\\[
H(z)=\\frac{Y(z)}{X(z)}=
\\frac{${H_num}}{${H_den}}
\\]

  </div>
</details>

<hr>

<h3>3. Z-Transform Shift Rule</h3>

<details>
  <summary style="font-size:15px; cursor:pointer;">Show Proof</summary>

  <div style="margin-left:20px; margin-top:10px;">

\\[
\\mathcal{Z}\\{x[n-k]\\}
=\\sum x[n-k]z^{-n}
=\\sum x[m]z^{-(m+k)}
=z^{-k}X(z)
\\]

  </div>
</details>

`;

  MathJax.typeset();
}

</script>

</body>
</html>
